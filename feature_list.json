{
  "features": [
    {
      "id": "F001",
      "category": "core",
      "description": "Create utility function to normalize ISO timestamp to directory-safe format",
      "priority": "critical",
      "steps": [
        "Create a new utility function that takes an ISO timestamp string",
        "Parse the timestamp and convert to format: YYYY-MM-DD_HH-MM-SS",
        "Handle invalid timestamps gracefully (return fallback format)",
        "Add unit tests for various timestamp formats",
        "Verify function works with example: 2025-12-15T17:00:00.000Z -> 2025-12-15_17-00-00"
      ],
      "passes": true
    },
    {
      "id": "F002",
      "category": "core",
      "description": "Create utility function to safely move files to archive directory",
      "priority": "critical",
      "steps": [
        "Create function that accepts source file path, destination directory, and filename",
        "Create destination directory if it doesn't exist (mkdir -p)",
        "Use fs.promises.rename or fs.promises.copyFile + fs.promises.unlink",
        "Handle errors gracefully (file not found, permission denied, etc.)",
        "Add unit tests for successful move and error cases",
        "Verify files are moved correctly and source is removed"
      ],
      "passes": true
    },
    {
      "id": "F003",
      "category": "core",
      "description": "Add function to check if feature_list.json exists before init",
      "priority": "high",
      "steps": [
        "In handleInit function, check if feature_list.json exists using fs.promises.stat",
        "If file exists, return true; if ENOENT error, return false",
        "Handle other errors appropriately",
        "Add test case for existing and non-existing files"
      ],
      "passes": true
    },
    {
      "id": "F004",
      "category": "core",
      "description": "Add function to read metadata.last_updated from feature_list.json",
      "priority": "high",
      "steps": [
        "Create function to read feature_list.json",
        "Parse JSON and extract metadata.last_updated property",
        "Return the timestamp string or undefined if not present",
        "Handle malformed JSON gracefully",
        "Add unit tests with valid and invalid JSON"
      ],
      "passes": true
    },
    {
      "id": "F005",
      "category": "core",
      "description": "Implement archive logic in handleInit before running initializer agent",
      "priority": "critical",
      "steps": [
        "Before creating new feature_list.json, check if one already exists",
        "If exists, read metadata.last_updated timestamp",
        "Normalize timestamp to directory name format",
        "Create .runs/<normalized-timestamp>/ directory",
        "Move feature_list.json to archive directory",
        "Move progress.txt to archive directory (if exists)",
        "Log archiving actions to console",
        "Continue with normal init flow"
      ],
      "passes": true
    },
    {
      "id": "F006",
      "category": "functional",
      "description": "Use current timestamp as fallback if last_updated is missing",
      "priority": "high",
      "steps": [
        "When reading metadata.last_updated, check if it's undefined/null",
        "If missing, generate current timestamp using new Date().toISOString()",
        "Use this fallback timestamp for directory naming",
        "Log warning that last_updated was missing",
        "Verify archives are created even with missing metadata"
      ],
      "passes": true
    },
    {
      "id": "F007",
      "category": "functional",
      "description": "Handle case where progress.txt doesn't exist during archiving",
      "priority": "medium",
      "steps": [
        "When archiving, check if progress.txt exists",
        "If it doesn't exist, skip moving it (don't throw error)",
        "Only move feature_list.json in this case",
        "Log that progress.txt was not found (optional)",
        "Verify init works when only feature_list.json exists"
      ],
      "passes": false
    },
    {
      "id": "F008",
      "category": "functional",
      "description": "Preserve .runs directory structure across multiple inits",
      "priority": "medium",
      "steps": [
        "Ensure .runs directory is created if it doesn't exist",
        "Each init creates a new timestamped subdirectory",
        "Verify multiple init operations create separate archives",
        "Check that old archives are not overwritten",
        "Test with 3+ consecutive init operations"
      ],
      "passes": false
    },
    {
      "id": "F009",
      "category": "error-handling",
      "description": "Handle file system errors during archiving gracefully",
      "priority": "high",
      "steps": [
        "Wrap archive operations in try-catch blocks",
        "If archiving fails, log error but don't abort init",
        "Consider creating backup with .bak extension as fallback",
        "Test with permission errors, disk full scenarios",
        "Verify init continues even if archiving fails"
      ],
      "passes": true
    },
    {
      "id": "F010",
      "category": "error-handling",
      "description": "Handle corrupted feature_list.json during archiving",
      "priority": "medium",
      "steps": [
        "If JSON parsing fails, still archive the file",
        "Use fallback timestamp (current time) for directory name",
        "Log warning about corrupted JSON",
        "Verify corrupted files are archived safely",
        "Init should still proceed successfully"
      ],
      "passes": false
    },
    {
      "id": "F011",
      "category": "ui",
      "description": "Display informative console messages during archiving",
      "priority": "medium",
      "steps": [
        "Print message: 'Existing project files found'",
        "Print message: 'Archiving to .runs/<timestamp>/'",
        "Print confirmation: 'Archived feature_list.json'",
        "Print confirmation: 'Archived progress.txt' (if applicable)",
        "Use consistent formatting with existing CLI output"
      ],
      "passes": false
    },
    {
      "id": "F012",
      "category": "ui",
      "description": "Respect --json flag when displaying archive messages",
      "priority": "low",
      "steps": [
        "Check if options.json is true",
        "If true, suppress console.log archiving messages",
        "Include archive info in final JSON output instead",
        "Add 'archived' boolean and 'archivePath' fields to JSON output",
        "Test both --json and normal output modes"
      ],
      "passes": false
    },
    {
      "id": "F013",
      "category": "ui",
      "description": "Respect --dry-run flag for archiving operations",
      "priority": "medium",
      "steps": [
        "Check if options.dryRun is true",
        "If true, log what WOULD be archived without moving files",
        "Print dry-run message: '[DRY RUN] Would archive to .runs/<timestamp>/'",
        "Don't create directories or move files in dry-run mode",
        "Verify --dry-run shows archive plan without executing"
      ],
      "passes": false
    },
    {
      "id": "F014",
      "category": "testing",
      "description": "Add unit tests for timestamp normalization function",
      "priority": "high",
      "steps": [
        "Create test file for archive utilities",
        "Test valid ISO timestamps",
        "Test timestamps with different timezones",
        "Test invalid/malformed timestamps",
        "Test edge cases (null, undefined, empty string)",
        "Verify all tests pass"
      ],
      "passes": false
    },
    {
      "id": "F015",
      "category": "testing",
      "description": "Add unit tests for file moving utility",
      "priority": "high",
      "steps": [
        "Create temp directory for testing",
        "Test successful file move",
        "Test moving non-existent file (should handle gracefully)",
        "Test creating nested directories",
        "Clean up temp files after tests",
        "Verify all tests pass"
      ],
      "passes": false
    },
    {
      "id": "F016",
      "category": "testing",
      "description": "Add integration test for full init archiving flow",
      "priority": "high",
      "steps": [
        "Create test that runs init twice in same directory",
        "Verify first init creates feature_list.json and progress.txt",
        "Verify second init archives first files",
        "Check .runs/<timestamp>/ directory was created",
        "Verify archived files match original content",
        "Clean up test files"
      ],
      "passes": false
    },
    {
      "id": "F017",
      "category": "testing",
      "description": "Test archiving with missing progress.txt",
      "priority": "medium",
      "steps": [
        "Create feature_list.json without progress.txt",
        "Run init command",
        "Verify feature_list.json is archived",
        "Verify no error occurs due to missing progress.txt",
        "Check archive directory contains only feature_list.json"
      ],
      "passes": false
    },
    {
      "id": "F018",
      "category": "testing",
      "description": "Test archiving with missing metadata.last_updated",
      "priority": "medium",
      "steps": [
        "Create feature_list.json without last_updated field",
        "Run init command",
        "Verify archiving uses current timestamp as fallback",
        "Verify archive directory name is in correct format",
        "Verify files are archived successfully"
      ],
      "passes": false
    },
    {
      "id": "F019",
      "category": "testing",
      "description": "Test multiple consecutive init operations",
      "priority": "medium",
      "steps": [
        "Run init command 3 times in sequence",
        "Verify 2 archive directories are created (2nd and 3rd init)",
        "Verify each archive has unique timestamp",
        "Verify no files are overwritten",
        "Check final state has current feature_list.json"
      ],
      "passes": false
    },
    {
      "id": "F020",
      "category": "documentation",
      "description": "Update CLI help text to mention archiving behavior",
      "priority": "low",
      "steps": [
        "Add note in printHelp() function under init command",
        "Mention: 'Existing feature_list.json will be archived to .runs/'",
        "Update examples section if needed",
        "Verify help text is clear and concise"
      ],
      "passes": false
    },
    {
      "id": "F021",
      "category": "documentation",
      "description": "Update pace init command documentation",
      "priority": "low",
      "steps": [
        "Update src/opencode/commands/pace-init.md",
        "Document archiving behavior",
        "Explain .runs directory structure",
        "Add example of archive directory naming",
        "Mention metadata.last_updated usage"
      ],
      "passes": false
    },
    {
      "id": "F022",
      "category": "documentation",
      "description": "Add JSDoc comments to archiving utility functions",
      "priority": "low",
      "steps": [
        "Add JSDoc to timestamp normalization function",
        "Document parameters and return values",
        "Add JSDoc to file moving function",
        "Include examples in JSDoc comments",
        "Follow existing code documentation style"
      ],
      "passes": false
    },
    {
      "id": "F023",
      "category": "documentation",
      "description": "Update README.md with archiving feature",
      "priority": "low",
      "steps": [
        "Add section about project archiving",
        "Explain when archiving occurs",
        "Document .runs directory structure",
        "Add example scenario",
        "Update features list to include archiving"
      ],
      "passes": false
    },
    {
      "id": "F024",
      "category": "refactoring",
      "description": "Extract archiving logic into separate module",
      "priority": "low",
      "steps": [
        "Create src/archive-manager.ts module",
        "Move timestamp normalization function to module",
        "Move file moving function to module",
        "Create ArchiveManager class with archive() method",
        "Import and use in handleInit",
        "Verify tests still pass"
      ],
      "passes": false
    },
    {
      "id": "F025",
      "category": "refactoring",
      "description": "Make archive directory path configurable",
      "priority": "low",
      "steps": [
        "Add optional archiveDir parameter to archive function",
        "Default to '.runs' if not specified",
        "Allow configuration via pace.json config file",
        "Update tests to use custom archive directory",
        "Document configuration option"
      ],
      "passes": false
    },
    {
      "id": "F026",
      "category": "integration",
      "description": "Ensure archiving works with existing FeatureManager",
      "priority": "medium",
      "steps": [
        "Test that FeatureManager.load() works after archiving",
        "Verify archived files don't interfere with new files",
        "Check that feature stats are calculated correctly",
        "Test update operations after archiving",
        "Run full orchestrator flow after init with archiving"
      ],
      "passes": false
    },
    {
      "id": "F027",
      "category": "integration",
      "description": "Verify git operations are not affected by archiving",
      "priority": "low",
      "steps": [
        "Check that .runs is in .gitignore (or should be)",
        "Test git status after archiving",
        "Verify archived files can be committed if desired",
        "Check git log functionality in StatusReporter",
        "Ensure no unexpected git behavior"
      ],
      "passes": false
    },
    {
      "id": "F028",
      "category": "edge-case",
      "description": "Handle case where .runs already contains conflicting directory",
      "priority": "low",
      "steps": [
        "Create .runs/<timestamp> directory manually",
        "Run init with same timestamp (unlikely but possible)",
        "Verify archiving handles conflict gracefully",
        "Consider appending -1, -2, etc. for conflicts",
        "Test conflict resolution logic"
      ],
      "passes": false
    },
    {
      "id": "F029",
      "category": "edge-case",
      "description": "Handle very long or invalid project directory paths",
      "priority": "low",
      "steps": [
        "Test with deeply nested project directory",
        "Test with directory names containing special characters",
        "Verify .runs directory is created in correct location",
        "Test with relative paths (e.g., ../project)",
        "Ensure path resolution is consistent"
      ],
      "passes": false
    },
    {
      "id": "F030",
      "category": "edge-case",
      "description": "Handle timezone differences in timestamp normalization",
      "priority": "low",
      "steps": [
        "Test timestamps from different timezones",
        "Verify directory names are consistent",
        "Consider normalizing to UTC for consistency",
        "Document timezone handling in JSDoc",
        "Add tests for various timezone formats"
      ],
      "passes": false
    },
    {
      "id": "F031",
      "category": "performance",
      "description": "Ensure archiving doesn't significantly slow down init",
      "priority": "low",
      "steps": [
        "Measure init time before adding archiving",
        "Measure init time after adding archiving",
        "Verify archiving adds less than 100ms overhead",
        "Use asynchronous file operations",
        "Consider parallel operations if possible"
      ],
      "passes": false
    },
    {
      "id": "F032",
      "category": "security",
      "description": "Validate directory paths to prevent path traversal",
      "priority": "medium",
      "steps": [
        "Ensure normalized timestamp cannot contain '..' or absolute paths",
        "Validate that archive directory is created within project dir",
        "Sanitize any user-provided paths",
        "Add security tests for malicious timestamps",
        "Document security considerations"
      ],
      "passes": false
    },
    {
      "id": "F033",
      "category": "verification",
      "description": "Verify archived files retain correct permissions",
      "priority": "low",
      "steps": [
        "Check file permissions before archiving",
        "Check file permissions after archiving",
        "Verify permissions are preserved",
        "Test with executable files if applicable",
        "Test on different platforms (Linux, macOS)"
      ],
      "passes": false
    },
    {
      "id": "F034",
      "category": "verification",
      "description": "Verify archived files are complete and not corrupted",
      "priority": "medium",
      "steps": [
        "Compare file sizes before and after archiving",
        "Compare checksums (MD5 or SHA256) of original and archived files",
        "Verify JSON files can be parsed after archiving",
        "Test with various file sizes",
        "Add corruption detection to tests"
      ],
      "passes": false
    },
    {
      "id": "F035",
      "category": "verification",
      "description": "End-to-end test: Full init workflow with archiving",
      "priority": "critical",
      "steps": [
        "Start with fresh project directory",
        "Run pace init with project description",
        "Verify feature_list.json and progress.txt are created",
        "Modify feature_list.json (mark some features as passing)",
        "Run pace init again with different description",
        "Verify old files are archived to .runs/<timestamp>/",
        "Verify new files are created",
        "Check both old and new files are intact",
        "Run pace status and validate command works"
      ],
      "passes": true
    },
    {
      "id": "F036",
      "category": "cli",
      "description": "Support --force flag to skip archiving and overwrite files",
      "priority": "low",
      "steps": [
        "Add --force option to init command parser",
        "When --force is set, skip archiving logic",
        "Directly overwrite existing feature_list.json",
        "Log warning that files are being overwritten",
        "Update help text to document --force flag"
      ],
      "passes": false
    },
    {
      "id": "F037",
      "category": "cli",
      "description": "Add --archive-only flag to archive without initializing",
      "priority": "low",
      "steps": [
        "Add --archive-only option to init command parser",
        "When set, run archiving logic but skip agent initialization",
        "Useful for cleaning up before manual init",
        "Exit after archiving is complete",
        "Document flag in help text"
      ],
      "passes": false
    },
    {
      "id": "F038",
      "category": "accessibility",
      "description": "Ensure archive messages are accessible in --json mode",
      "priority": "low",
      "steps": [
        "Add 'archive' object to JSON output",
        "Include 'archived' boolean field",
        "Include 'archivePath' string field",
        "Include 'archivedFiles' array",
        "Test JSON output parsing"
      ],
      "passes": false
    },
    {
      "id": "F039",
      "category": "logging",
      "description": "Create archive metadata file in each archive directory",
      "priority": "low",
      "steps": [
        "Create .archive-info.json in each .runs/<timestamp>/ directory",
        "Include original metadata from feature_list.json",
        "Add archive timestamp",
        "Add reason (e.g., 'pace init')",
        "Include list of archived files",
        "Make this optional/configurable"
      ],
      "passes": false
    },
    {
      "id": "F040",
      "category": "cleanup",
      "description": "Add utility command to list archived runs",
      "priority": "low",
      "steps": [
        "Create 'pace archives' or 'pace list-archives' command",
        "List all directories in .runs/",
        "Show timestamp and basic metadata for each",
        "Support --json output format",
        "Add to help text"
      ],
      "passes": false
    },
    {
      "id": "F041",
      "category": "cleanup",
      "description": "Add utility command to restore archived run",
      "priority": "low",
      "steps": [
        "Create 'pace restore <timestamp>' command",
        "Copy files from .runs/<timestamp>/ back to project root",
        "Prompt for confirmation before overwriting",
        "Support --force flag to skip confirmation",
        "Add to help text"
      ],
      "passes": false
    },
    {
      "id": "F042",
      "category": "cleanup",
      "description": "Add utility command to delete old archives",
      "priority": "low",
      "steps": [
        "Create 'pace clean-archives' command",
        "Support --older-than <days> option",
        "Support --keep-last <n> option",
        "Prompt for confirmation before deleting",
        "Add to help text"
      ],
      "passes": false
    },
    {
      "id": "F043",
      "category": "gitignore",
      "description": "Ensure .runs directory is properly git-ignored",
      "priority": "medium",
      "steps": [
        "Check if .gitignore includes .runs/",
        "Add .runs/ to .gitignore if not present",
        "Consider making this configurable (some may want to commit archives)",
        "Document git ignore behavior",
        "Test that archived files don't appear in git status"
      ],
      "passes": false
    },
    {
      "id": "F044",
      "category": "backwards-compatibility",
      "description": "Ensure new archiving doesn't break existing pace installations",
      "priority": "high",
      "steps": [
        "Test with projects initialized before this feature",
        "Verify first init after upgrade handles missing .runs gracefully",
        "Ensure metadata fields are optional",
        "Test migration path from old to new behavior",
        "Add upgrade notes to release"
      ],
      "passes": false
    },
    {
      "id": "F045",
      "category": "ci",
      "description": "Add CI tests for archiving functionality",
      "priority": "medium",
      "steps": [
        "Add archiving tests to GitHub Actions workflow",
        "Test on multiple OS (Linux, macOS, Windows if supported)",
        "Verify tests pass in CI environment",
        "Add to pr-check.yml workflow",
        "Ensure coverage for all archiving code paths"
      ],
      "passes": false
    },
    {
      "id": "F046",
      "category": "code-quality",
      "description": "Ensure archiving code passes linting",
      "priority": "high",
      "steps": [
        "Run eslint on new archiving code",
        "Fix any linting errors",
        "Ensure no console.log in non-CLI code",
        "Verify imports are properly organized",
        "Run prettier to format code"
      ],
      "passes": false
    },
    {
      "id": "F047",
      "category": "code-quality",
      "description": "Add type safety for archive-related functions",
      "priority": "medium",
      "steps": [
        "Define types for archive options",
        "Define types for archive results",
        "Avoid 'any' types in archiving code",
        "Use proper error types",
        "Export types for external use if needed"
      ],
      "passes": false
    },
    {
      "id": "F048",
      "category": "validation",
      "description": "Validate archive directory structure",
      "priority": "low",
      "steps": [
        "Create function to check if .runs/<dir> is a valid archive",
        "Verify it contains expected files",
        "Check for corruption or incomplete archives",
        "Report validation results",
        "Use in archive listing command"
      ],
      "passes": false
    },
    {
      "id": "F049",
      "category": "user-experience",
      "description": "Provide clear feedback when no files need archiving",
      "priority": "low",
      "steps": [
        "Detect when init is run in empty directory",
        "Display message: 'No existing files to archive'",
        "Proceed directly to initialization",
        "Don't create empty archive directories",
        "Test UX with fresh projects"
      ],
      "passes": false
    },
    {
      "id": "F050",
      "category": "user-experience",
      "description": "Show archive location in init success message",
      "priority": "low",
      "steps": [
        "After successful archiving, include archive path in output",
        "Example: 'Previous run archived to: .runs/2025-12-15_17-00-00/'",
        "Make message prominent but not intrusive",
        "Include in both verbose and normal modes",
        "Format consistently with other CLI output"
      ],
      "passes": false
    }
  ],
  "metadata": {
    "project_name": "pace-init-archiving",
    "created_at": "2025-12-17",
    "total_features": 50,
    "passing": 8,
    "failing": 42,
    "last_updated": "2025-12-17T00:00:00.000Z"
  }
}
